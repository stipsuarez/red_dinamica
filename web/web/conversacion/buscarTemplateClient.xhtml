<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                template="./../../templates/GeneralTemplate.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core">

    <ui:define name="contenido">
        <p:layoutUnit position="center" header="Buscar">

            <h:form id="buscar" class="tablaPostula" >
                <p:messages id="msgs_errores" ></p:messages>  
           
                <h:outputLabel value="Filtrar por: " for="filtro"  />
                <h:selectOneMenu id="filtro" value="#{usuariosController.filtar_por}" title="Filtar usuarios por" validator="#{usuariosController.asignarFiltro}" >
                    <f:selectItem itemValue="1" itemLabel="Nombre" />
                    <f:selectItem itemValue="2" itemLabel="Email" />
                    <f:selectItem itemValue="3" itemLabel="Universidad" />
                    <p:ajax  update="grupo_buscar,tablaEnc,msgs_errores" />
                </h:selectOneMenu>

                <h:panelGroup id="grupo_buscar">
                    <h:inputText id="nombre_buscar" rendered="#{!usuariosController.buscarU}" value="#{usuariosController.nombre_buscar}" title="Usuario a buscar" validator="#{usuariosController.asignarNombreBuscar}" >
                        <p:ajax  event="keyup" listener="#{usuariosController.aplicarFiltro}"   update="growlB,tablaEnc,msgs_errores" />  
                    </h:inputText>

                    <h:selectOneMenu id="U_buscar"  rendered="#{usuariosController.buscarU}" value="#{usuariosController.u_select}" title="Universidades" validator="#{usuariosController.aplicarFiltroUs}">
                        <f:selectItems value="#{usuariosController.listaUs}"/>
                        <p:ajax update="growlB,tablaEnc,msgs_errores" />  
                    </h:selectOneMenu>
                </h:panelGroup>
                <p:dataTable id="tablaEnc" sortMode="multiple" selection="#{conversacionController.usrDestino}" var="usuariosE" value="#{usuariosController.listaUsuariosE}" widgetVar="tablaPost" emptyMessage="No hay solicitudes disponibles" paginator="true" rows="10"
                             rowKey="#{usuariosE.usrId}"  >  
                    <f:facet name="header">  
                        <p:outputPanel>  
                            <h:outputText value="Buscar en todos los campos:" />  
                            <p:inputText id="globalFilter" onkeyup="tablaPost.filter()" style="width:150px" />  
                            <p:messages id="msgs_error" >Error: </p:messages> 
                        </p:outputPanel>  
                    </f:facet>  
                    <p:column style="width:5%" headerText="Mas Info.">                                                           
                        <p:rowToggler />  
                    </p:column>  
                    <p:column style="width:20%" headerText="ImÃ¡gen de Perfil">  
                        <p:graphicImage value="/Recursos/Imagenes/perfil/#{usuariosE.usrId}" width="170" height="200"/>  
                    </p:column>  

                    <p:column id="nombre" style="width:20%"  headerText="Nombres" filterValue="#{usuariosE.usrNombres}"
                              filterMatchMode="contains" sortBy="#{usuariosE.usrNombres}" filterBy="#{usuariosE.usrNombres}" > 
                        <h:outputText value="#{usuariosE.usrNombres}" />  
                    </p:column> 

                    <p:column id="apellido"  style="width:20%" filterBy="#{usuariosE.usrApellidos}"   
                              headerText="Apellidos"   filterMatchMode="contains" sortBy="#{usuariosE.usrApellidos}" >  
                        <h:outputText value="#{usuariosE.usrApellidos}" />  
                    </p:column> 

                    <p:column id="email" style="width:20%" filterBy="#{usuariosE.usrEmail}"   
                              headerText="E-Mail"   filterMatchMode="contains" sortBy="#{usuariosE.usrEmail}">  

                        <h:outputText value="#{usuariosE.usrEmail}" />  
                    </p:column>  

                    <p:column  style="width:15%" headerText="Enviar Mensaje" id="enviar_msj"  >
                        <h:messages errorStyle="color: red" infoStyle="color: green" layout="table"/>
                        <p:commandButton  id="enviar_msjs" icon="ui-icon-comment" action="#{usuariosController.irA('enviarMsj')}" value="Enviar mensaje" >
                            <f:setPropertyActionListener target="#{conversacionController.usrDestino}" value="#{usuariosE}" />   

                        </p:commandButton>
                        <p:commandLink action="#{usuariosController.irA('enviarMsj')}" value="enviar"  >                               
                            <f:setPropertyActionListener target="#{conversacionController.usrDestino}" value="#{usuariosE}" /> 
                            <p:ajax listener="#{usuariosController.irA('enviarMsj')}"   update="growlB,tablaEnc,msgs_errores" />
                        </p:commandLink>
                        <p:commandButton  id="enviar" update=":form:" action="#{usuariosController.irA('enviarMsj')}" value="Leer mas"  ajax="false">
                            <f:setPropertyActionListener value="#{usuariosE}" target="#{conversacionController.selected.convUsr2Id}" /> 
                        </p:commandButton> 

                    </p:column>

                    <p:rowExpansion>  
                        <h:panelGrid id="display" columns="2" cellpadding="5" style="width:100%"  
                                     styleClass="ui-widget-content grid">  
                            <h:outputText value="Cedula de Ciudadania:" />
                            <h:outputText id="detalle_descripcion" value="#{usuariosE.usrId}"   />      
                            <h:outputText value="Ciudad:" />  
                            <h:outputText id="detalle_ciudad" value="#{usuariosE.usrCiudad}"/>  
                        </h:panelGrid>  
                    </p:rowExpansion>  
                </p:dataTable>  
                <p:commandButton value="Enviar" action="#{solicitudesController.aceptarSolicitudes}" update="growl"/>
            </h:form>           

        </p:layoutUnit>

    </ui:define>
</ui:composition>
